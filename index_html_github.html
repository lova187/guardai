<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GuardAI - אימון הגנה עצמית</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.3/vision_bundle.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #111827, #000000); }
    </style>
</head>
<body class="gradient-bg text-white min-h-screen">
    <div id="root">
        <div class="max-w-4xl mx-auto p-8">
            <!-- Header -->
            <header class="text-center mb-12">
                <div class="flex items-center justify-center gap-4 mb-6">
                    <svg class="w-12 h-12 text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1v7z"/>
                    </svg>
                    <h1 class="text-4xl font-bold bg-gradient-to-r from-emerald-400 to-blue-400 bg-clip-text text-transparent">
                        GuardAI
                    </h1>
                </div>
                <p class="text-xl text-gray-300 mb-8">
                    האפליקציה שמאמנת אותך להגנה עצמית בעזרת בינה מלאכותית
                </p>
            </header>

            <!-- Main Content -->
            <main class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Camera Section -->
                <div class="bg-gray-800/50 backdrop-blur-sm rounded-xl p-6">
                    <h2 class="text-2xl font-bold mb-4">🎯 מצלמת אימון</h2>
                    <div class="aspect-video bg-black rounded-lg mb-4 flex items-center justify-center">
                        <video id="video" class="w-full h-full object-cover rounded-lg" autoplay muted playsinline style="transform: scaleX(-1);"></video>
                        <canvas id="canvas" class="absolute inset-0 w-full h-full pointer-events-none" style="transform: scaleX(-1);"></canvas>
                        <div id="placeholder" class="text-gray-400 text-center">
                            <svg class="w-16 h-16 mx-auto mb-4" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clip-rule="evenodd" />
                            </svg>
                            <p>לחץ "התחל אימון" לגישה למצלמה</p>
                        </div>
                    </div>
                    <div class="flex gap-3">
                        <button id="start-btn" class="bg-emerald-500 hover:bg-emerald-600 px-6 py-3 rounded-lg font-semibold transition-colors">
                            ▶️ התחל אימון
                        </button>
                        <button id="stop-btn" class="bg-red-500 hover:bg-red-600 px-6 py-3 rounded-lg font-semibold transition-colors hidden">
                            ⏹️ עצור אימון
                        </button>
                    </div>
                </div>

                <!-- Info Section -->
                <div class="bg-gray-800/50 backdrop-blur-sm rounded-xl p-6">
                    <h2 class="text-2xl font-bold mb-4">📊 משוב בזמן אמת</h2>
                    <div id="feedback" class="space-y-4">
                        <div class="text-yellow-400">
                            <h3 class="font-semibold mb-2">💡 הוראות:</h3>
                            <ul id="tips" class="text-sm space-y-1">
                                <li>• עמוד מול המצלמה</li>
                                <li>• רגליים ברוחב כתפיים</li>
                                <li>• ידיים מוכנות להגנה</li>
                            </ul>
                        </div>
                        <div class="text-emerald-400">
                            <h3 class="font-semibold mb-2">✅ מצוין:</h3>
                            <ul id="good" class="text-sm space-y-1">
                                <li>מוכן לאימון!</li>
                            </ul>
                        </div>
                    </div>

                    <div class="mt-8 p-4 bg-blue-900/30 rounded-lg">
                        <h3 class="font-semibold mb-2">🏆 תכונות מתקדמות:</h3>
                        <ul class="text-sm space-y-2 text-blue-300">
                            <li>🎯 ניתוח תנועות בזמן אמת</li>
                            <li>🔥 אימון תחת לחץ</li>
                            <li>📈 מעקב התקדמות</li>
                            <li>🏅 מערכת הישגים</li>
                        </ul>
                    </div>
                </div>
            </main>

            <!-- Footer -->
            <footer class="text-center mt-12 text-gray-400">
                <p>🛡️ GuardAI - הדרך החכמה ללמוד הגנה עצמית</p>
            </footer>
        </div>
    </div>

    <script>
        // Basic camera functionality
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const placeholder = document.getElementById('placeholder');
        const startBtn = document.getElementById('start-btn');
        const stopBtn = document.getElementById('stop-btn');
        const tips = document.getElementById('tips');
        const good = document.getElementById('good');

        let stream = null;
        let isTraining = false;

        startBtn.addEventListener('click', async () => {
            try {
                stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: 'user' }, 
                    audio: false 
                });
                video.srcObject = stream;
                video.style.display = 'block';
                placeholder.style.display = 'none';
                startBtn.classList.add('hidden');
                stopBtn.classList.remove('hidden');
                isTraining = true;

                // Simulate AI feedback
                startFeedbackLoop();
            } catch (err) {
                alert('לא ניתן לגשת למצלמה. אנא בדוק הרשאות.');
                console.error('Camera error:', err);
            }
        });

        stopBtn.addEventListener('click', () => {
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                video.srcObject = null;
            }
            video.style.display = 'none';
            placeholder.style.display = 'block';
            startBtn.classList.remove('hidden');
            stopBtn.classList.add('hidden');
            isTraining = false;
        });

        function startFeedbackLoop() {
            if (!isTraining) return;

            const feedbackOptions = [
                { tips: ['להרחיב רגליים', 'לכופף ברכיים'], good: ['עמידה יציבה'] },
                { tips: ['להרים הגנה'], good: ['זמן תגובה מהיר'] },
                { tips: [], good: ['מצוין! טכניקה מושלמת'] }
            ];

            const feedback = feedbackOptions[Math.floor(Math.random() * feedbackOptions.length)];
            
            tips.innerHTML = feedback.tips.length > 0 
                ? feedback.tips.map(tip => `<li>• ${tip}</li>`).join('')
                : '<li>• הכל נראה מושלם!</li>';
                
            good.innerHTML = feedback.good.map(item => `<li>✓ ${item}</li>`).join('');

            setTimeout(() => startFeedbackLoop(), 3000);
        }

        // Check MediaPipe availability
        if (window.FilesetResolver && window.PoseLandmarker) {
            console.log('✅ MediaPipe loaded successfully');
        } else {
            console.warn('⚠️ MediaPipe not available, using basic mode');
        }
    </script>
</body>
</html>
